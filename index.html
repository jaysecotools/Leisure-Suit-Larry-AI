<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leisure Suit Larry: AI Adventures</title>
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, sans-serif;
        }

        :root {
            --primary: #9b59b6;
            --primary-dark: #8e44ad;
            --secondary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --surface: #34495e;
            --surface-light: #4a6583;
            --text: #ffffff;
            --text-secondary: #bdc3c7;
            --adult: #e84393;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c 0%, #b21f1f 50%, #fdbb2d 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        /* Age Gate */
        .age-gate {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.98);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            text-align: center;
        }

        .age-gate h1 {
            color: var(--warning);
            margin-bottom: 20px;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
        }

        .age-gate p {
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: 30px;
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: var(--text-secondary);
        }

        .adult-warning {
            background: rgba(232, 67, 147, 0.2);
            border: 2px solid var(--adult);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            max-width: 600px;
        }

        .age-gate-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .age-btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .age-confirm {
            background: linear-gradient(to right, var(--adult), #fd79a8);
            color: white;
        }

        .age-deny {
            background: linear-gradient(to right, var(--danger), #c0392b);
            color: white;
        }

        /* Main Container */
        .main-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 1200px;
            margin: 0 auto;
            opacity: 0;
            animation: fadeIn 1s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Header */
        .game-header {
            background: var(--surface);
            padding: 15px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .game-title {
            text-align: center;
            font-size: clamp(1.5rem, 4vw, 2rem);
            color: var(--warning);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            background: var(--surface-light);
            padding: 8px 15px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .stat-icon {
            font-size: 1.2rem;
        }

        .adult-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--adult);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: bold;
            display: none;
        }

        /* Quest Tracker */
        .quest-tracker {
            background: var(--surface-light);
            border-radius: 10px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .quest-title {
            color: var(--warning);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .quest-progress {
            height: 8px;
            background: var(--surface);
            border-radius: 4px;
            overflow: hidden;
        }

        .quest-bar {
            height: 100%;
            background: linear-gradient(to right, var(--success), var(--warning));
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Scene Container */
        .scene-container {
            background: var(--dark);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            min-height: 300px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .scene {
            width: 100%;
            height: 100%;
            position: relative;
            padding: 20px;
        }

        .location-name {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
            z-index: 10;
        }

        .mood-meter {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            z-index: 10;
        }

        .mood-fill {
            width: 50px;
            height: 8px;
            background: var(--surface-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .mood-level {
            height: 100%;
            background: linear-gradient(to right, var(--danger), var(--warning), var(--success));
            transition: width 0.5s ease;
        }

        /* Characters */
        .character-container {
            position: absolute;
            bottom: 50px;
            display: flex;
            justify-content: space-between;
            width: calc(100% - 40px);
            z-index: 5;
        }

        .character, .npc {
            width: 60px;
            height: 100px;
            position: relative;
            transition: transform 0.3s ease;
        }

        .character:hover, .npc:hover {
            transform: translateY(-5px);
        }

        .character-body, .npc-body {
            width: 100%;
            height: 80px;
            background: linear-gradient(to bottom, var(--secondary), #2980b9);
            border-radius: 10px 10px 0 0;
            position: absolute;
            bottom: 0;
        }

        .character-head, .npc-head {
            width: 50px;
            height: 50px;
            background: var(--warning);
            border-radius: 50%;
            position: absolute;
            top: -25px;
            left: 5px;
        }

        .npc-body {
            background: linear-gradient(to bottom, var(--danger), #c0392b);
        }

        .npc-head {
            background: #e67e22;
        }

        /* Interactive Items */
        .items-container {
            position: absolute;
            width: 100%;
            height: calc(100% - 150px);
            pointer-events: none;
        }

        .interactive-item {
            position: absolute;
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 20;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .interactive-item:hover, .interactive-item:active {
            transform: scale(1.2) rotate(10deg);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        .item-adult {
            background: var(--adult);
            border: 2px solid #ff9ff3;
        }

        /* Panels Container */
        .panels-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .panels-container {
                flex-direction: row;
            }
        }

.items-container {
    position: absolute;
    width: 100%;
    height: calc(100% - 150px);
    pointer-events: none;
    overflow: visible; /* Ensure items aren't clipped */
}

.interactive-item {
    position: absolute;
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.8rem;
    cursor: pointer;
    pointer-events: auto;
    transition: all 0.3s, left 0.5s ease, top 0.5s ease; /* Added transitions for position */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 20; /* Base z-index */
    animation: float 3s ease-in-out infinite;
    will-change: transform, z-index; /* Optimize for animations */
}

/* Add a new animation for when items are collected */
@keyframes collect {
    0% { 
        transform: scale(1) rotate(0deg);
        opacity: 1;
    }
    50% { 
        transform: scale(1.5) rotate(180deg);
        opacity: 0.7;
    }
    100% { 
        transform: scale(0) rotate(360deg);
        opacity: 0;
    }
}

/* Add a class for when item is being collected */
.interactive-item.collecting {
    animation: collect 0.5s ease forwards !important;
    pointer-events: none;
}

/* Add these mobile adjustments */
@media (max-width: 767px) {
    .interactive-item {
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
    }
    
    /* Adjust positioning for mobile */
    .items-container {
        height: calc(100% - 120px);
    }
}

@media (max-width: 480px) {
    .interactive-item {
        width: 35px;
        height: 35px;
        font-size: 1.3rem;
    }
}

.items-container {
    position: absolute;
    width: 100%;
    height: calc(100% - 150px);
    pointer-events: none;
    overflow: visible;
}

.interactive-item {
    position: absolute;
    width: 50px;
    height: 50px;
    background: var(--primary);
    border-radius: 12px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.8rem;
    cursor: pointer;
    pointer-events: auto;
    transition: all 0.3s, left 0.5s ease, top 0.5s ease;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 20;
    animation: float 3s ease-in-out infinite;
    will-change: transform, left, top;
    border: 2px solid rgba(255, 255, 255, 0.2);
}

/* Glow effect for adult items */
.interactive-item.item-adult {
    box-shadow: 0 0 15px rgba(232, 67, 147, 0.7);
    border-color: rgba(232, 67, 147, 0.5);
}

/* Hover effect to make overlapping items more visible */
.interactive-item:hover {
    transform: scale(1.2) rotate(10deg) !important;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.6);
    z-index: 100 !important; /* Bring to front on hover */
    border-color: rgba(241, 196, 15, 0.8);
}

/* Pulse animation for important items */
@keyframes pulse-glow {
    0%, 100% { 
        box-shadow: 0 0 10px rgba(241, 196, 15, 0.5);
    }
    50% { 
        box-shadow: 0 0 20px rgba(241, 196, 15, 0.8);
    }
}

.interactive-item.important {
    animation: float 3s ease-in-out infinite, pulse-glow 2s ease-in-out infinite;
}

/* Mobile adjustments */
@media (max-width: 767px) {
    .interactive-item {
        width: 40px;
        height: 40px;
        font-size: 1.5rem;
    }
    
    /* Increase spacing for mobile */
    .items-container {
        height: calc(100% - 120px);
    }
}

@media (max-width: 480px) {
    .interactive-item {
        width: 35px;
        height: 35px;
        font-size: 1.3rem;
    }
}

        /* Inventory Panel */
        .inventory-panel {
            background: var(--surface);
            border-radius: 15px;
            padding: 15px;
            flex: 1;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .panel-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
            color: var(--warning);
            border-bottom: 2px solid var(--surface-light);
            padding-bottom: 8px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px;
        }

        .inventory-item {
            aspect-ratio: 1;
            background: var(--surface-light);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.8rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .inventory-item:hover, .inventory-item.selected {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(241, 196, 15, 0.4);
        }

        .inventory-item.selected {
            border: 3px solid var(--warning);
            background: var(--surface);
        }

        .item-name {
            font-size: 0.6rem;
            margin-top: 5px;
            text-align: center;
            color: var(--text-secondary);
        }

        .item-adult-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--adult);
            color: white;
            font-size: 0.6rem;
            padding: 1px 4px;
            border-radius: 4px;
            display: none;
        }

        /* Dialog Panel */
        .dialog-panel {
            background: var(--surface);
            border-radius: 15px;
            padding: 15px;
            flex: 2;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .dialog-content {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 200px;
            max-height: 300px;
        }

        .message {
            padding: 10px 15px;
            border-radius: 15px;
            max-width: 85%;
            animation: slideIn 0.3s ease;
            word-wrap: break-word;
            line-height: 1.4;
            font-size: 0.95rem;
            position: relative;
            clear: both;
            margin: 5px 0;
        }

        @keyframes slideIn {
            from { 
                opacity: 0; 
                transform: translateY(10px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        .message.npc-message {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.9), rgba(192, 57, 43, 0.9));
            color: white;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            margin-right: auto;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
            border-left: 4px solid #fff;
        }

        .message.player-message {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.9), rgba(41, 128, 185, 0.9));
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            margin-left: auto;
            box-shadow: -2px 2px 8px rgba(0, 0, 0, 0.2);
            border-right: 4px solid #fff;
        }

        .message.adult-message {
            background: linear-gradient(135deg, rgba(232, 67, 147, 0.9), rgba(214, 48, 49, 0.9));
            border-color: #ff9ff3;
        }

        .dialog-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            max-height: 150px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .dialog-option {
            background: var(--surface-light);
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            border: 1px solid transparent;
        }

        .dialog-option:hover {
            background: var(--primary);
            transform: translateY(-2px);
            border-color: var(--warning);
        }

        .dialog-option.adult-option {
            background: rgba(232, 67, 147, 0.3);
            border: 1px dashed var(--adult);
        }

        .dialog-option.adult-option:hover {
            background: var(--adult);
        }

        .dialog-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: var(--surface) !important;
            transform: none !important;
        }

        /* Comments Panel */
        .comments-panel {
            background: var(--surface);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .comments-container {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .comment {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            animation: fadeInUp 0.5s ease;
            border-left: 3px solid var(--warning);
        }

        .comment.adult-comment {
            border-left-color: var(--adult);
            background: rgba(232, 67, 147, 0.1);
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.8rem;
            color: var(--warning);
        }

        .comment-text {
            font-style: italic;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        @media (min-width: 480px) {
            .action-buttons {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: var(--surface-light);
            color: var(--text);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(to right, var(--secondary), #2980b9);
        }

        .btn-success {
            background: linear-gradient(to right, var(--success), #27ae60);
        }

        .btn-danger {
            background: linear-gradient(to right, var(--danger), #c0392b);
        }

        .btn-warning {
            background: linear-gradient(to right, var(--warning), #f39c12);
        }

        .btn-adult {
            background: linear-gradient(to right, var(--adult), #fd79a8);
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        /* Footer */
        .game-footer {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .game-footer {
                flex-direction: row;
                justify-content: space-between;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            text-align: center;
        }

        .notification.show {
            opacity: 1;
        }

        .notification.adult {
            background: var(--adult);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* AI Controls */
        .ai-controls {
            position: absolute;
            bottom: 15px;
            left: 15px;
            z-index: 30;
        }

        .ai-toggle {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }

        .ai-toggle:hover {
            background: var(--primary-dark);
        }

        /* Mini-map */
        .mini-map {
            position: absolute;
            bottom: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px;
            border-radius: 10px;
            display: flex;
            gap: 5px;
            z-index: 30;
        }

        .map-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--surface-light);
        }

        .map-dot.active {
            background: var(--warning);
            box-shadow: 0 0 8px var(--warning);
        }

        /* Mobile Optimizations */
        @media (max-width: 767px) {
            .character, .npc {
                width: 50px;
                height: 80px;
            }
            
            .character-body, .npc-body {
                height: 60px;
            }
            
            .character-head, .npc-head {
                width: 40px;
                height: 40px;
                top: -20px;
            }
            
            .interactive-item {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }
            
            .dialog-options {
                grid-template-columns: 1fr;
            }
            
            .btn {
                padding: 12px;
                font-size: 0.8rem;
            }
            
            .message {
                max-width: 90%;
                padding: 8px 12px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .game-stats {
                flex-direction: column;
                align-items: center;
            }
            
            .stat {
                width: 100%;
                justify-content: center;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Age Gate -->
    <div class="age-gate" id="age-gate">
        <h1>‚ö†Ô∏è ADULT CONTENT WARNING</h1>
        <p>This game contains mature themes, explicit dialogue, adult humor, and suggestive content intended for players 18 years and older.</p>
        
        <div class="adult-warning">
            <p>‚ö†Ô∏è Content includes:</p>
            <ul style="text-align: left; margin: 10px 0 0 20px;">
                <li>Sexual themes and innuendo</li>
                <li>Explicit romantic encounters</li>
                <li>Adult-oriented humor</li>
                <li>Suggestive situations</li>
            </ul>
        </div>
        
        <div class="age-gate-buttons">
            <button class="age-btn age-confirm" id="age-confirm">I AM 18+ - ENTER GAME</button>
            <button class="age-btn age-deny" id="age-deny">I AM UNDER 18 - EXIT</button>
        </div>
    </div>

    <!-- Main Game Container -->
    <div class="main-container" id="game-container" style="display: none;">
        <!-- Header -->
        <header class="game-header">
            <h1 class="game-title">Leisure Suit Larry: AI Adventures</h1>
            <div class="adult-indicator" id="adult-indicator">ADULT MODE</div>
            <div class="game-stats">
                <div class="stat">
                    <span class="stat-icon">üèÜ</span>
                    <span>Score: <span id="score-value">250</span></span>
                </div>
                <div class="stat">
                    <span class="stat-icon">‚è±Ô∏è</span>
                    <span>Time: <span id="time-value">12:45</span></span>
                </div>
                <div class="stat">
                    <span class="stat-icon">‚ù§Ô∏è</span>
                    <span>Relationship: <span id="relationship-value">15</span></span>
                </div>
                <div class="stat">
                    <span class="stat-icon">üéØ</span>
                    <span>Progress: <span id="progress-value">0%</span></span>
                </div>
            </div>
            
            <!-- Quest Tracker -->
            <div class="quest-tracker" id="quest-tracker">
                <div class="quest-title">Current Quest: <span id="current-quest">Get Eve's attention</span></div>
                <div class="quest-progress">
                    <div class="quest-bar" id="quest-bar"></div>
                </div>
                <div class="quest-description" id="quest-description" style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 5px;"></div>
            </div>
        </header>

        <!-- Game Content -->
        <div class="game-content">
            <!-- Scene -->
            <div class="scene-container">
                <div class="scene" id="scene">
                    <div class="location-name" id="location-name">Le Bar de l'Amour</div>
                    <div class="mood-meter">
                        <span>Mood:</span>
                        <div class="mood-fill">
                            <div class="mood-level" id="mood-level" style="width: 50%;"></div>
                        </div>
                    </div>
                    
                    <div class="character-container">
                        <div class="character" id="player-character">
                            <div class="character-body"></div>
                            <div class="character-head"></div>
                            <div class="character-tooltip" style="position: absolute; bottom: -25px; width: 100%; text-align: center; font-size: 0.7rem; color: var(--secondary);">Larry</div>
                        </div>
                        <div class="npc" id="eve-character">
                            <div class="npc-body"></div>
                            <div class="npc-head"></div>
                            <div class="npc-tooltip" style="position: absolute; bottom: -25px; width: 100%; text-align: center; font-size: 0.7rem; color: var(--danger);">Eve</div>
                        </div>
                    </div>
                    
                    <div class="items-container" id="items-container">
                        <!-- Interactive items will be added here -->
                    </div>
                    
                    <div class="ai-controls">
                        <button class="ai-toggle" id="ai-toggle">
                            <span>ü§ñ AI: ON</span>
                        </button>
                    </div>
                    
                    <div class="mini-map" id="mini-map">
                        <!-- Mini-map dots will be added here -->
                    </div>
                </div>
            </div>

            <!-- Panels -->
            <div class="panels-container">
                <!-- Inventory -->
                <div class="inventory-panel">
                    <h3 class="panel-title">üéí Inventory (<span id="inventory-count">0</span>/12)</h3>
                    <div class="inventory-grid" id="inventory-grid">
                        <!-- Inventory items will be added here -->
                    </div>
                </div>

                <!-- Dialog -->
                <div class="dialog-panel">
                    <h3 class="panel-title">üí¨ Conversation with <span id="current-npc">Eve</span></h3>
                    <div class="dialog-content" id="dialog-content">
                        <!-- Messages will be added here -->
                    </div>
                    <div class="dialog-options" id="dialog-options">
                        <!-- Dialog options will be added here -->
                    </div>
                </div>
            </div>

            <!-- Comments -->
            <div class="comments-panel">
                <h3 class="panel-title">üí≠ NPC Thoughts</h3>
                <div class="comments-container" id="comments-container">
                    <!-- Comments will be added here -->
                </div>
            </div>

            <!-- Footer -->
            <footer class="game-footer">
                <div class="action-buttons">
                    <button class="btn btn-primary" id="look-btn">
                        <span class="btn-icon">üëÅÔ∏è</span>
                        <span>Look</span>
                    </button>
                    <button class="btn btn-primary" id="talk-btn">
                        <span class="btn-icon">üí¨</span>
                        <span>Talk</span>
                    </button>
                    <button class="btn btn-warning" id="use-btn">
                        <span class="btn-icon">üéØ</span>
                        <span>Use Item</span>
                    </button>
                    <button class="btn btn-success" id="move-btn">
                        <span class="btn-icon">üö∂</span>
                        <span>Move</span>
                    </button>
                    <button class="btn" id="examine-btn">
                        <span class="btn-icon">üîç</span>
                        <span>Examine</span>
                    </button>
                    <button class="btn btn-adult" id="flirt-btn">
                        <span class="btn-icon">üíã</span>
                        <span>Flirt</span>
                    </button>
                    <button class="btn" id="quest-info-btn" style="background: linear-gradient(to right, var(--primary), var(--secondary));">
                        <span class="btn-icon">üìã</span>
                        <span>Quest Info</span>
                    </button>
                </div>
                
                <div class="action-buttons">
                    <button class="btn" id="save-btn">
                        <span class="btn-icon">üíæ</span>
                        <span>Save</span>
                    </button>
                    <button class="btn" id="load-btn">
                        <span class="btn-icon">üìÇ</span>
                        <span>Load</span>
                    </button>
                    <button class="btn btn-danger" id="reset-btn">
                        <span class="btn-icon">üîÑ</span>
                        <span>Reset</span>
                    </button>
                </div>
            </footer>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Enhanced Game State - FIXED VERSION
        const gameState = {
            ageVerified: false,
            adultMode: false,
            score: 250,
            time: 765,
            relationship: 15,
            mood: 50,
            intimacy: 0,
            progress: 0, // FIXED: Starting at 0%
            currentLocation: 'bar',
            currentQuest: 0, // First quest is index 0
            questsCompleted: 0,
            inventory: ['money', 'phone', 'carKeys', 'sunglasses'],
            selectedItem: null,
            aiMode: true,
            locations: [
                { 
                    id: 'bar', 
                    name: 'Le Bar de l\'Amour', 
                    items: ['briefcase', 'drink', 'key', 'wine', 'napkin'],
                    npcs: ['Eve', 'Bartender', 'Jessica'],
                    adultAvailable: true
                },
                { 
                    id: 'hotel', 
                    name: 'Hotel Lobby', 
                    items: ['flowers', 'perfume', 'roomKey', 'champagne'],
                    npcs: ['Receptionist', 'Maid', 'Danielle'],
                    adultAvailable: true
                },
                { 
                    id: 'beach', 
                    name: 'Sunset Beach', 
                    items: ['shell', 'towel', 'sunscreen', 'cocktail'],
                    npcs: ['Lifeguard', 'Ashley', 'BikiniGirl'],
                    adultAvailable: false
                },
                { 
                    id: 'casino', 
                    name: 'Golden Casino', 
                    items: ['chips', 'dice', 'cigar', 'whiskey'],
                    npcs: ['Dealer', 'Nicole', 'RichMan'],
                    adultAvailable: true
                },
                { 
                    id: 'hotelRoom', 
                    name: 'Hotel Suite', 
                    items: ['robe', 'candle', 'chocolate', 'lube'],
                    npcs: ['Eve'],
                    adultAvailable: true,
                    locked: true
                }
            ],
            items: {
                // Regular items
                briefcase: { emoji: 'üíº', name: 'Mystery Briefcase', adult: false },
                drink: { emoji: 'üç∏', name: 'Exotic Cocktail', adult: false },
                key: { emoji: 'üîë', name: 'Golden Key', adult: false },
                money: { emoji: 'üíµ', name: 'Cash', adult: false },
                phone: { emoji: 'üì±', name: 'Smartphone', adult: false },
                carKeys: { emoji: 'üöó', name: 'Car Keys', adult: false },
                sunglasses: { emoji: 'üï∂Ô∏è', name: 'Sunglasses', adult: false },
                flowers: { emoji: 'üíê', name: 'Flowers', adult: false },
                perfume: { emoji: 'üß¥', name: 'Perfume', adult: false },
                shell: { emoji: 'üêö', name: 'Seashell', adult: false },
                towel: { emoji: 'üèñÔ∏è', name: 'Beach Towel', adult: false },
                chips: { emoji: 'ü™ô', name: 'Poker Chips', adult: false },
                dice: { emoji: 'üé≤', name: 'Lucky Dice', adult: false },
                
                // Adult items (unlocked later)
                condom: { emoji: 'üíã', name: 'Protection', adult: true },
                wine: { emoji: 'üç∑', name: 'Romantic Wine', adult: true },
                roomKey: { emoji: 'üè®', name: 'Room Key', adult: true },
                champagne: { emoji: 'üçæ', name: 'Champagne', adult: true },
                sunscreen: { emoji: 'üß¥', name: 'Sunscreen', adult: true },
                cigar: { emoji: 'üö¨', name: 'Cigar', adult: true },
                whiskey: { emoji: 'ü•É', name: 'Whiskey', adult: true },
                robe: { emoji: 'üëò', name: 'Silk Robe', adult: true },
                candle: { emoji: 'üïØÔ∏è', name: 'Scented Candle', adult: true },
                chocolate: { emoji: 'üç´', name: 'Chocolate', adult: true },
                lube: { emoji: 'üíß', name: 'Massage Oil', adult: true },
                napkin: { emoji: 'üßª', name: 'Napkin', adult: false },
                cocktail: { emoji: 'üçπ', name: 'Beach Cocktail', adult: true },
                ticket: { emoji: 'üé´', name: 'Concert Ticket', adult: false }
            },
            npcs: {
                Eve: { mood: 50, relationship: 15, intimacy: 0, adultTolerance: 7 },
                Bartender: { mood: 40, relationship: 5, adultTolerance: 8 },
                Jessica: { mood: 60, relationship: 0, adultTolerance: 6 },
                Receptionist: { mood: 30, relationship: 0, adultTolerance: 5 },
                Maid: { mood: 50, relationship: 0, adultTolerance: 6 },
                Danielle: { mood: 55, relationship: 0, adultTolerance: 7 },
                Lifeguard: { mood: 40, relationship: 0, adultTolerance: 4 },
                Ashley: { mood: 65, relationship: 0, adultTolerance: 8 },
                BikiniGirl: { mood: 70, relationship: 0, adultTolerance: 9 },
                Dealer: { mood: 45, relationship: 0, adultTolerance: 7 },
                Nicole: { mood: 60, relationship: 0, adultTolerance: 7 },
                RichMan: { mood: 30, relationship: 0, adultTolerance: 8 }
            },
            quests: [
                { 
                    id: 1, 
                    name: "Get Eve's attention", 
                    description: "Make Eve notice you by saying something interesting", 
                    progress: 0, 
                    completed: false, 
                    reward: 100,
                    objective: "Talk to Eve using interesting conversation options"
                },
                { 
                    id: 2, 
                    name: "Buy a drink", 
                    description: "Get a drink for Eve to break the ice", 
                    progress: 0, 
                    completed: false, 
                    reward: 150,
                    objective: "Use the 'Offer a drink' dialog option"
                },
                { 
                    id: 3, 
                    name: "Find flowers", 
                    description: "Get flowers to impress Eve", 
                    progress: 0, 
                    completed: false, 
                    reward: 200,
                    objective: "Collect flowers from the Hotel Lobby"
                },
                { 
                    id: 4, 
                    name: "Get perfume", 
                    description: "Find Eve's favorite perfume", 
                    progress: 0, 
                    completed: false, 
                    reward: 250,
                    objective: "Collect perfume from the Hotel Lobby"
                },
                { 
                    id: 5, 
                    name: "Get a hotel room", 
                    description: "Secure a room for the night", 
                    progress: 0, 
                    completed: false, 
                    reward: 300, 
                    adult: true,
                    objective: "Collect the room key and build relationship to 70+"
                },
                { 
                    id: 6, 
                    name: "Romantic evening", 
                    description: "Spend intimate time with Eve", 
                    progress: 0, 
                    completed: false, 
                    reward: 500, 
                    adult: true,
                    objective: "Use adult items and flirt to increase intimacy"
                }
            ],
            npcComments: [],
            messages: []
        };

        // DOM Elements
        const ageGate = document.getElementById('age-gate');
        const gameContainer = document.getElementById('game-container');
        const adultIndicator = document.getElementById('adult-indicator');
        const scoreElement = document.getElementById('score-value');
        const timeElement = document.getElementById('time-value');
        const relationshipElement = document.getElementById('relationship-value');
        const progressElement = document.getElementById('progress-value');
        const moodElement = document.getElementById('mood-level');
        const locationElement = document.getElementById('location-name');
        const questTracker = document.getElementById('quest-tracker');
        const currentQuestElement = document.getElementById('current-quest');
        const questDescriptionElement = document.getElementById('quest-description');
        const questBar = document.getElementById('quest-bar');
        const itemsContainer = document.getElementById('items-container');
        const inventoryGrid = document.getElementById('inventory-grid');
        const inventoryCountElement = document.getElementById('inventory-count');
        const dialogContent = document.getElementById('dialog-content');
        const dialogOptions = document.getElementById('dialog-options');
        const commentsContainer = document.getElementById('comments-container');
        const notification = document.getElementById('notification');
        const aiToggle = document.getElementById('ai-toggle');
        const miniMap = document.getElementById('mini-map');
        const playerCharacter = document.getElementById('player-character');
        const eveCharacter = document.getElementById('eve-character');
        const currentNpcElement = document.getElementById('current-npc');

        // Enhanced Response Generator
        class EnhancedAI {
            constructor() {
                this.responses = {
                    neutral: [
                        "Interesting approach. Let's see where this goes.",
                        "You're not like the others. I'll give you that.",
                        "That was... unexpected.",
                        "You certainly know how to get my attention.",
                        "I'm listening. Continue."
                    ],
                    positive: [
                        "That's actually quite charming!",
                        "You're making this difficult to resist.",
                        "I'm starting to see your appeal.",
                        "That was surprisingly sweet.",
                        "Okay, you've got my full attention now."
                    ],
                    negative: [
                        "Seriously? That's your best line?",
                        "I've had better conversations with a wall.",
                        "You're trying too hard.",
                        "That's not going to work on me.",
                        "Maybe you should try a different approach."
                    ],
                    adult: [
                        "You're being quite forward... I like it.",
                        "Now you're speaking my language.",
                        "That's bold. Let's see if you can back it up.",
                        "You have my attention... and my interest.",
                        "Finally, someone who isn't afraid to be direct."
                    ],
                    explicit: [
                        "You're not shy, are you? I appreciate that.",
                        "Let's take this somewhere more... private.",
                        "I like where this is heading.",
                        "You've definitely piqued my interest.",
                        "Why don't you show me what you've got?"
                    ]
                };
            }

            getResponse(mood, relationship, adultLevel = 0) {
                let responseSet;
                
                if (relationship > 70 && adultLevel > 0 && gameState.adultMode) {
                    responseSet = adultLevel > 5 ? this.responses.explicit : this.responses.adult;
                } else if (mood > 70) {
                    responseSet = this.responses.positive;
                } else if (mood > 40) {
                    responseSet = this.responses.neutral;
                } else {
                    responseSet = this.responses.negative;
                }
                
                return responseSet[Math.floor(Math.random() * responseSet.length)];
            }
        }

        const enhancedAI = new EnhancedAI();

        // Initialize the game
        function initGame() {
            updateStats();
            renderScene();
            renderInventory();
            renderMiniMap();
            addMessage('Eve: Another night, another hopeful romantic. Make it interesting.', 'npc');
            addComment('Eve', 'I wonder if this one will actually say something original for once.');
            updateDialogOptions();
            startGameTimer();
            setupEventListeners();
            
            // Show quest tracker
            questTracker.style.display = 'block';
            updateQuestTracker();
        }

        // Age Verification
        document.getElementById('age-confirm').addEventListener('click', () => {
            gameState.ageVerified = true;
            gameState.adultMode = true;
            ageGate.style.display = 'none';
            gameContainer.style.display = 'block';
            adultIndicator.style.display = 'block';
            showNotification('Adult Mode Enabled! Welcome to the full experience!', 'adult');
            initGame();
            
            // Add adult items to inventory
            gameState.inventory.push('condom', 'ticket');
            renderInventory();
        });

        document.getElementById('age-deny').addEventListener('click', () => {
            gameState.ageVerified = true;
            gameState.adultMode = false;
            ageGate.style.display = 'none';
            gameContainer.style.display = 'block';
            showNotification('Standard Mode Enabled. Some content may be restricted.');
            initGame();
        });

        // Update game stats display
        function updateStats() {
            scoreElement.textContent = gameState.score;
            relationshipElement.textContent = gameState.relationship;
            progressElement.textContent = `${gameState.progress}%`;
            moodElement.style.width = `${gameState.mood}%`;
            
            // Update mood color
            if (gameState.mood > 70) {
                moodElement.style.background = 'linear-gradient(to right, #2ecc71, #27ae60)';
            } else if (gameState.mood > 30) {
                moodElement.style.background = 'linear-gradient(to right, #f1c40f, #e67e22)';
            } else {
                moodElement.style.background = 'linear-gradient(to right, #e74c3c, #c0392b)';
            }
        }

        // Update quest tracker - FIXED VERSION
        function updateQuestTracker() {
            const currentQuest = gameState.quests[gameState.currentQuest];
            
            if (currentQuest) {
                currentQuestElement.textContent = currentQuest.name;
                questBar.style.width = `${currentQuest.progress}%`;
                questDescriptionElement.textContent = currentQuest.description;
                
                // Update quest bar color based on progress
                if (currentQuest.progress < 30) {
                    questBar.style.background = 'linear-gradient(to right, #e74c3c, #c0392b)';
                } else if (currentQuest.progress < 70) {
                    questBar.style.background = 'linear-gradient(to right, #f1c40f, #e67e22)';
                } else {
                    questBar.style.background = 'linear-gradient(to right, #2ecc71, #27ae60)';
                }
                
                // Check if quest should be completed
                if (currentQuest.progress >= 100 && !currentQuest.completed) {
                    completeQuest(currentQuest.id);
                }
                
                // Calculate overall game progress
                updateOverallProgress();
            }
        }

        // Update overall game progress
        function updateOverallProgress() {
            const completedQuests = gameState.quests.filter(q => q.completed).length;
            const totalQuests = gameState.quests.length;
            gameState.progress = Math.floor((completedQuests / totalQuests) * 100);
            progressElement.textContent = `${gameState.progress}%`;
            
            // Visual effect when progress increases
            if (gameState.progress > 0 && gameState.progress % 20 === 0) {
                progressElement.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    progressElement.style.transform = 'scale(1)';
                }, 300);
            }
        }

        // Helper function to update quest progress - FIXED
        function updateQuestProgress(questId, amount) {
            const quest = gameState.quests.find(q => q.id === questId);
            if (quest && !quest.completed) {
                const oldProgress = quest.progress;
                quest.progress = Math.min(100, Math.max(0, quest.progress + amount));
                
                if (quest.progress !== oldProgress) {
                    showNotification(`Quest Progress: ${quest.name} (${quest.progress}%)`);
                    updateQuestTracker();
                    
                    // Check if quest is now complete
                    if (quest.progress >= 100 && !quest.completed) {
                        completeQuest(questId);
                    }
                }
            }
        }

        // Complete a quest - FIXED VERSION
        function completeQuest(questId) {
            const quest = gameState.quests.find(q => q.id === questId);
            if (quest && !quest.completed) {
                quest.completed = true;
                gameState.score += quest.reward;
                gameState.questsCompleted++;
                
                // Show quest completion animation
                questBar.style.animation = 'pulse 0.5s 3';
                setTimeout(() => {
                    questBar.style.animation = '';
                }, 1500);
                
                showNotification(`üéâ Quest Completed: ${quest.name}! +${quest.reward} points`, 'success');
                
                // Find next available quest
                const nextQuestIndex = gameState.quests.findIndex(q => !q.completed);
                if (nextQuestIndex !== -1) {
                    gameState.currentQuest = nextQuestIndex;
                    const nextQuest = gameState.quests[nextQuestIndex];
                    
                    // Add comment about new quest
                    if (nextQuest.adult && !gameState.adultMode) {
                        addComment('Eve', 'He might be ready for more, but he needs to enable adult mode...');
                    } else {
                        addComment('Eve', `Hmm, maybe he's ready for ${nextQuest.name.toLowerCase()}...`);
                    }
                }
                
                updateStats();
                updateQuestTracker();
                updateOverallProgress();
            }
        }

// Render the current scene
function renderScene() {
    const location = gameState.locations.find(loc => loc.id === gameState.currentLocation);
    locationElement.textContent = location.name;
    currentNpcElement.textContent = location.npcs[0] || 'NPC';
    
    // Clear items
    itemsContainer.innerHTML = '';
    
    // Filter items based on adult mode
    const visibleItems = location.items.filter(itemId => {
        const item = gameState.items[itemId];
        return item && (gameState.adultMode || !item.adult);
    });
    
    // Store occupied positions to prevent overlap
    const occupiedPositions = [];
    const itemWidth = 50; // Width in pixels (approximate)
    const itemHeight = 50; // Height in pixels (approximate)
    const margin = 15; // Minimum margin between items
    
    // Get container dimensions
    const containerWidth = itemsContainer.offsetWidth;
    const containerHeight = itemsContainer.offsetHeight;
    
    visibleItems.forEach((itemId, index) => {
        const item = gameState.items[itemId];
        if (item) {
            const itemElement = document.createElement('div');
            itemElement.className = `interactive-item ${item.adult ? 'item-adult' : ''}`;
            itemElement.textContent = item.emoji;
            itemElement.title = `${item.name}${item.adult ? ' (18+)' : ''}`;
            
            // Try to find a non-overlapping position
            let x, y;
            let attempts = 0;
            const maxAttempts = 50;
            
            do {
                // Distribute items in a non-uniform pattern to look natural
                if (visibleItems.length <= 3) {
                    // For few items, place them in a horizontal line
                    x = 20 + (index * 25) + (Math.random() * 10 - 5);
                    y = 30 + (Math.random() * 30);
                } else if (visibleItems.length <= 6) {
                    // For medium number of items, use a grid
                    const cols = Math.ceil(Math.sqrt(visibleItems.length));
                    const row = Math.floor(index / cols);
                    const col = index % cols;
                    x = 10 + (col * 30) + (Math.random() * 10 - 5);
                    y = 20 + (row * 25) + (Math.random() * 10 - 5);
                } else {
                    // For many items, use a spiral pattern
                    const angle = index * 0.618 * Math.PI * 2; // Golden angle
                    const radius = Math.sqrt(index) * 8;
                    x = 50 + Math.cos(angle) * radius + (Math.random() * 10 - 5);
                    y = 40 + Math.sin(angle) * radius + (Math.random() * 10 - 5);
                }
                
                // Ensure within bounds
                x = Math.max(5, Math.min(95, x));
                y = Math.max(10, Math.min(80, y));
                
                // Check for overlap
                let hasOverlap = false;
                for (const pos of occupiedPositions) {
                    const distance = Math.sqrt(Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2));
                    // Convert percentage distance to approximate pixel distance
                    const pixelDistance = distance * Math.min(containerWidth, containerHeight) / 100;
                    
                    if (pixelDistance < (itemWidth + margin)) {
                        hasOverlap = true;
                        break;
                    }
                }
                
                if (!hasOverlap) {
                    break;
                }
                
                attempts++;
                
                // If too many attempts, force a position but adjust to reduce overlap
                if (attempts >= maxAttempts) {
                    // Find the position with least overlap
                    let bestX = x, bestY = y, minOverlap = Infinity;
                    
                    for (let i = 0; i < 10; i++) {
                        const testX = Math.random() * 80 + 10;
                        const testY = Math.random() * 60 + 20;
                        let maxOverlap = 0;
                        
                        for (const pos of occupiedPositions) {
                            const distance = Math.sqrt(Math.pow(testX - pos.x, 2) + Math.pow(testY - pos.y, 2));
                            const pixelDistance = distance * Math.min(containerWidth, containerHeight) / 100;
                            const overlap = Math.max(0, itemWidth + margin - pixelDistance);
                            if (overlap > maxOverlap) {
                                maxOverlap = overlap;
                            }
                        }
                        
                        if (maxOverlap < minOverlap) {
                            minOverlap = maxOverlap;
                            bestX = testX;
                            bestY = testY;
                        }
                    }
                    
                    x = bestX;
                    y = bestY;
                    break;
                }
            } while (true);
            
            // Store this position as occupied
            occupiedPositions.push({ x, y });
            
            // Set position
            itemElement.style.left = `${x}%`;
            itemElement.style.top = `${y}%`;
            
            // Add z-index based on vertical position to handle any remaining overlap
            itemElement.style.zIndex = Math.floor(y);
            
            // Add a subtle rotation for variety
            itemElement.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
            
            // Set animation delay for floating effect
            itemElement.style.animationDelay = `${index * 0.1}s`;
            
            itemElement.addEventListener('click', () => collectItem(itemId));
            
            itemsContainer.appendChild(itemElement);
        }
    });
    
    // If we still have overlap issues, adjust positions after all items are placed
    if (occupiedPositions.length > 1) {
        setTimeout(() => {
            const items = itemsContainer.querySelectorAll('.interactive-item');
            const itemElements = Array.from(items);
            
            // Check and fix any remaining overlaps
            itemElements.forEach((item, i) => {
                const rect1 = item.getBoundingClientRect();
                
                for (let j = i + 1; j < itemElements.length; j++) {
                    const otherItem = itemElements[j];
                    const rect2 = otherItem.getBoundingClientRect();
                    
                    // Check for overlap
                    if (rect1.left < rect2.right && rect1.right > rect2.left &&
                        rect1.top < rect2.bottom && rect1.bottom > rect2.top) {
                        
                        // Move the second item slightly
                        const currentLeft = parseFloat(otherItem.style.left);
                        const currentTop = parseFloat(otherItem.style.top);
                        
                        // Move away from overlapping item
                        const directionX = currentLeft - parseFloat(item.style.left);
                        const directionY = currentTop - parseFloat(item.style.top);
                        const length = Math.sqrt(directionX * directionX + directionY * directionY);
                        
                        if (length > 0) {
                            const moveX = (directionX / length) * 5;
                            const moveY = (directionY / length) * 5;
                            
                            otherItem.style.left = `${Math.max(5, Math.min(95, currentLeft + moveX))}%`;
                            otherItem.style.top = `${Math.max(10, Math.min(80, currentTop + moveY))}%`;
                        } else {
                            // If items are exactly on top of each other, move randomly
                            otherItem.style.left = `${Math.max(5, Math.min(95, currentLeft + (Math.random() * 10 - 5)))}%`;
                            otherItem.style.top = `${Math.max(10, Math.min(80, currentTop + (Math.random() * 10 - 5)))}%`;
                        }
                    }
                }
            });
        }, 100);
    }
}
        // Render mini-map
        function renderMiniMap() {
            miniMap.innerHTML = '';
            gameState.locations.forEach((location, index) => {
                const dot = document.createElement('div');
                dot.className = `map-dot ${location.id === gameState.currentLocation ? 'active' : ''} ${location.locked ? 'locked' : ''}`;
                dot.title = `${location.name}${location.locked ? ' (Locked)' : ''}`;
                
                // Style locked locations
                if (location.locked) {
                    dot.style.background = '#7f8c8d';
                    dot.style.opacity = '0.5';
                }
                
                dot.addEventListener('click', () => {
                    if (location.locked) {
                        if (location.id === 'hotelRoom' && gameState.relationship < 70) {
                            showNotification(`You need relationship level 70+ to access the Hotel Suite! (Current: ${gameState.relationship})`);
                            return;
                        }
                    }
                    gameState.currentLocation = location.id;
                    renderScene();
                    renderMiniMap();
                    showNotification(`Traveled to: ${location.name}`);
                    addMessage(`Larry: *Arrives at ${location.name}*`, 'player');
                });
                miniMap.appendChild(dot);
            });
        }

        // Render inventory
        function renderInventory() {
            inventoryGrid.innerHTML = '';
            
            // Filter items based on adult mode
            const visibleItems = gameState.inventory.filter(itemId => {
                const item = gameState.items[itemId];
                return item && (gameState.adultMode || !item.adult);
            });
            
            inventoryCountElement.textContent = visibleItems.length;
            
            visibleItems.forEach(itemId => {
                const item = gameState.items[itemId];
                if (item) {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'inventory-item';
                    if (gameState.selectedItem === itemId) {
                        itemElement.classList.add('selected');
                    }
                    
                    itemElement.innerHTML = `
                        ${item.emoji}
                        <div class="item-name">${item.name}</div>
                        ${item.adult ? '<div class="item-adult-badge" style="display: block;">18+</div>' : ''}
                    `;
                    
                    itemElement.title = `${item.name}${item.adult ? ' (Adult Item)' : ''}`;
                    
                    itemElement.addEventListener('click', () => {
                        gameState.selectedItem = gameState.selectedItem === itemId ? null : itemId;
                        renderInventory();
                        showNotification(`${gameState.selectedItem === itemId ? 'Selected:' : 'Deselected:'} ${item.name}`);
                    });
                    
                    inventoryGrid.appendChild(itemElement);
                }
            });
            
            // Add empty slots
            const emptySlots = 12 - visibleItems.length;
            for (let i = 0; i < emptySlots; i++) {
                const emptySlot = document.createElement('div');
                emptySlot.className = 'inventory-item';
                emptySlot.style.opacity = '0.3';
                emptySlot.innerHTML = '‚ûï';
                emptySlot.title = 'Empty slot';
                inventoryGrid.appendChild(emptySlot);
            }
        }

        // Add a message to the dialog
        function addMessage(text, sender, adult = false) {
            const messageElement = document.createElement('div');
            
            if (sender === 'npc') {
                messageElement.className = `message npc-message ${adult ? 'adult-message' : ''}`;
            } else {
                messageElement.className = `message player-message ${adult ? 'adult-message' : ''}`;
            }
            
            messageElement.textContent = text;
            dialogContent.appendChild(messageElement);
            
            // Scroll to bottom with animation
            setTimeout(() => {
                dialogContent.scrollTo({
                    top: dialogContent.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
            
            // Keep only last 15 messages
            const messages = dialogContent.querySelectorAll('.message');
            if (messages.length > 15) {
                messages[0].remove();
            }
        }

        // Add NPC comment
        function addComment(npc, text, adult = false) {
            const comment = {
                npc,
                text,
                time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                adult
            };
            
            gameState.npcComments.unshift(comment);
            
            // Keep only last 6 comments
            if (gameState.npcComments.length > 6) {
                gameState.npcComments.pop();
            }
            
            renderComments();
        }

        // Render NPC comments
        function renderComments() {
            commentsContainer.innerHTML = '';
            
            gameState.npcComments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = `comment ${comment.adult ? 'adult-comment' : ''}`;
                
                commentElement.innerHTML = `
                    <div class="comment-header">
                        <span>${comment.npc}</span>
                        <span>${comment.time}</span>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                `;
                
                commentsContainer.appendChild(commentElement);
            });
            
            // Scroll to top
            commentsContainer.scrollTop = 0;
        }

        // Update dialog options
        function updateDialogOptions() {
            dialogOptions.innerHTML = '';
            
            const location = gameState.locations.find(loc => loc.id === gameState.currentLocation);
            const currentNPC = location.npcs[0] || 'Eve';
            
            const options = [
                { text: "Compliment her appearance", mood: 10, relationship: 5, adult: 0, questId: 1, progress: 30 },
                { text: "Offer a drink", mood: 5, relationship: 3, adult: 0, questId: 2, progress: 50 },
                { text: "Tell a joke", mood: -5, relationship: 2, adult: 0 },
                { text: "Ask about her interests", mood: 15, relationship: 8, adult: 0, questId: 1, progress: 20 },
            ];
            
            // Add adult options if available
            if (gameState.adultMode && location.adultAvailable && gameState.relationship > 40) {
                options.push(
                    { text: "Make a suggestive comment", mood: -10, relationship: 10, adult: 3, questId: 6, progress: 15 },
                    { text: "Invite her somewhere private", mood: -20, relationship: 15, adult: 5, questId: 6, progress: 25 }
                );
            }
            
            if (gameState.adultMode && gameState.relationship > 60) {
                options.push(
                    { text: "Whisper something naughty", mood: 5, relationship: 20, adult: 7, questId: 6, progress: 30 },
                    { text: "Suggest getting a room", mood: 10, relationship: 25, adult: 8, questId: 5, progress: 50 }
                );
            }
            
            // Add quest-specific options
            const currentQuest = gameState.quests[gameState.currentQuest];
            if (currentQuest && !currentQuest.completed) {
                if (currentQuest.id === 3 && gameState.inventory.includes('flowers')) {
                    options.push({ text: "Give her the flowers", mood: 30, relationship: 20, adult: 0, questId: 3, progress: 100 });
                }
                if (currentQuest.id === 4 && gameState.inventory.includes('perfume')) {
                    options.push({ text: "Give her the perfume", mood: 25, relationship: 15, adult: 0, questId: 4, progress: 100 });
                }
            }
            
            options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = `dialog-option ${option.adult > 0 ? 'adult-option' : ''}`;
                optionElement.textContent = `${index + 1}. ${option.text}`;
                
                let disabled = false;
                let disabledReason = '';
                
                if (option.adult > 0 && !gameState.adultMode) {
                    disabled = true;
                    disabledReason = "Adult content disabled";
                } else if (option.adult > (gameState.npcs[currentNPC]?.adultTolerance || 5)) {
                    disabled = true;
                    disabledReason = "Too forward for this character";
                } else if (option.text.includes("flowers") && !gameState.inventory.includes('flowers')) {
                    disabled = true;
                    disabledReason = "You need flowers first!";
                } else if (option.text.includes("perfume") && !gameState.inventory.includes('perfume')) {
                    disabled = true;
                    disabledReason = "You need perfume first!";
                }
                
                if (disabled) {
                    optionElement.classList.add('disabled');
                    optionElement.title = disabledReason;
                } else {
                    optionElement.addEventListener('click', () => {
                        selectDialogOption(option, currentNPC);
                    });
                    optionElement.title = option.questId ? "Advances quest progress" : "";
                }
                
                dialogOptions.appendChild(optionElement);
            });
        }

        // Handle dialog option selection - FIXED WITH QUEST PROGRESS
        function selectDialogOption(option, npcName) {
            addMessage(`Larry: ${option.text}`, 'player', option.adult > 0);
            
            // Update quest progress for relevant options
            if (option.questId && option.progress) {
                updateQuestProgress(option.questId, option.progress);
            }
            
            // Generate AI response
            setTimeout(() => {
                const response = enhancedAI.getResponse(
                    gameState.mood,
                    gameState.relationship,
                    option.adult
                );
                
                addMessage(`${npcName}: ${response}`, 'npc', option.adult > 0);
                
                // Update game state
                gameState.mood = Math.max(0, Math.min(100, gameState.mood + option.mood));
                gameState.relationship += option.relationship;
                gameState.score += 25 + (option.adult * 10);
                
                // Update NPC state
                if (gameState.npcs[npcName]) {
                    gameState.npcs[npcName].relationship += option.relationship;
                    if (option.adult > 0) {
                        gameState.npcs[npcName].intimacy += option.adult;
                    }
                }
                
                updateStats();
                updateQuestTracker();
                addComment(npcName, generateAIComment(option.adult), option.adult > 0);
                
                // Visual feedback
                if (option.mood > 0) {
                    eveCharacter.style.transform = 'translateY(-10px) scale(1.1)';
                    setTimeout(() => {
                        eveCharacter.style.transform = 'translateY(0) scale(1)';
                    }, 500);
                }
                
                // Update dialog options for next interaction
                updateDialogOptions();
                
                // Check for special events
                checkSpecialEvents(option, npcName);
            }, 500);
        }

        // Generate AI comment
        function generateAIComment(adultLevel = 0) {
            const comments = [
                'He actually said something interesting for once.',
                'I might give him a chance if he keeps this up.',
                'Same old lines, different guy.',
                'There might be hope for him yet.',
                'I wonder if he knows how transparent he is.'
            ];
            
            if (adultLevel > 0 && gameState.adultMode) {
                comments.push(
                    'He\'s being quite forward... I like that.',
                    'Finally someone who isn\'t afraid to go there.',
                    'This could get interesting...',
                    'He knows what he wants, I\'ll give him that.',
                    'Maybe tonight won\'t be so boring after all.'
                );
            }
            
            if (gameState.mood > 70) {
                comments.push('I\'m actually enjoying this conversation!');
                comments.push('He\'s not like the others...');
            } else if (gameState.mood < 30) {
                comments.push('How much longer do I have to pretend to be interested?');
                comments.push('This is getting painful to watch.');
            }
            
            if (gameState.relationship > 50) {
                comments.push('He\'s growing on me...');
            }
            
            return comments[Math.floor(Math.random() * comments.length)];
        }

        // Check for special events
        function checkSpecialEvents(option, npcName) {
            // Unlock hotel room when relationship is high enough
            if (gameState.relationship >= 70 && gameState.locations[4].locked) {
                gameState.locations[4].locked = false;
                showNotification('üè® Hotel Suite unlocked! Relationship level reached!', 'adult');
                addComment(npcName, 'Maybe we should continue this in my suite...', true);
                renderMiniMap();
            }
            
            // Check for quest item usage
            if (option.text.includes("Give her the flowers") && gameState.inventory.includes('flowers')) {
                // Remove flowers from inventory after giving
                const flowerIndex = gameState.inventory.indexOf('flowers');
                if (flowerIndex > -1) {
                    gameState.inventory.splice(flowerIndex, 1);
                    renderInventory();
                }
            }
            
            if (option.text.includes("Give her the perfume") && gameState.inventory.includes('perfume')) {
                // Remove perfume from inventory after giving
                const perfumeIndex = gameState.inventory.indexOf('perfume');
                if (perfumeIndex > -1) {
                    gameState.inventory.splice(perfumeIndex, 1);
                    renderInventory();
                }
            }
        }

// Collect an item - FIXED WITH QUEST PROGRESS
function collectItem(itemId) {
    if (!gameState.inventory.includes(itemId)) {
        const item = gameState.items[itemId];
        
        // Check if adult item in non-adult mode
        if (item.adult && !gameState.adultMode) {
            showNotification('Adult content item - Enable Adult Mode to collect');
            return;
        }
        
        // Check inventory limit
        if (gameState.inventory.length >= 12) {
            showNotification('Inventory full! Cannot collect more items.');
            return;
        }
        
        // Add collection animation
        const itemElement = event.target;
        itemElement.classList.add('collecting');
        
        // Create a flying animation to inventory
        const itemClone = itemElement.cloneNode(true);
        itemClone.style.position = 'fixed';
        itemClone.style.zIndex = '1000';
        itemClone.style.animation = 'none';
        itemClone.style.transition = 'all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
        document.body.appendChild(itemClone);
        
        // Get inventory position
        const inventoryPanel = document.querySelector('.inventory-panel');
        const inventoryRect = inventoryPanel.getBoundingClientRect();
        const itemRect = itemElement.getBoundingClientRect();
        
        // Animate to inventory
        setTimeout(() => {
            itemClone.style.left = `${inventoryRect.left + 20}px`;
            itemClone.style.top = `${inventoryRect.top + 20}px`;
            itemClone.style.transform = 'scale(0.5) rotate(720deg)';
            itemClone.style.opacity = '0';
        }, 10);
        
        // Wait for animation to complete before continuing
        setTimeout(() => {
            // Remove clone
            itemClone.remove();
            
            // Add item to inventory
            gameState.inventory.push(itemId);
            gameState.score += 50 + (item.adult ? 50 : 0);
            
            showNotification(`Found: ${item.name}! +${50 + (item.adult ? 50 : 0)} points`, item.adult ? 'adult' : '');
            
            // Update quest progress based on collected items
            if (itemId === 'flowers') {
                updateQuestProgress(3, 50);
            }
            if (itemId === 'perfume') {
                updateQuestProgress(4, 50);
            }
            if (itemId === 'roomKey') {
                updateQuestProgress(5, 50);
            }
            if (itemId === 'wine' || itemId === 'champagne') {
                updateQuestProgress(6, 10);
            }
            
            renderInventory();
            updateStats();
            updateQuestTracker();
            addComment('Eve', `He found a ${item.name}. ${item.adult ? 'How... interesting.' : 'Maybe he\'s luckier than he looks.'}`, item.adult);
            
            // Re-render scene to remove collected item
            renderScene();
        }, 500); // Match animation duration
    } else {
        showNotification(`Already have: ${gameState.items[itemId].name}`);
    }
}
        // Show notification with enhanced visuals
        function showNotification(text, type = '') {
            notification.textContent = text;
            notification.className = `notification ${type} show`;
            
            // Add pulse animation for important notifications
            if (type === 'adult' || text.includes('Quest Completed') || text.includes('unlocked')) {
                notification.style.animation = 'pulse 0.5s 2';
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
                notification.style.animation = '';
            }, 2000);
        }

        // Start game timer
        function startGameTimer() {
            setInterval(() => {
                gameState.time++;
                const minutes = Math.floor(gameState.time / 60);
                const seconds = gameState.time % 60;
                timeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Every minute, update mood slightly
                if (gameState.time % 60 === 0) {
                    gameState.mood = Math.max(0, gameState.mood - 1);
                    updateStats();
                }
            }, 1000);
        }

        // Show quest information
        function showQuestInfo() {
            const currentQuest = gameState.quests[gameState.currentQuest];
            const allQuests = gameState.quests;
            
            let info = `=== QUEST PROGRESS ===\n`;
            info += `Overall: ${gameState.progress}%\n`;
            info += `Quests Completed: ${gameState.questsCompleted}/${allQuests.length}\n\n`;
            
            info += `CURRENT QUEST:\n`;
            info += `‚úì ${currentQuest.name}\n`;
            info += `Progress: ${currentQuest.progress}%\n`;
            info += `Objective: ${currentQuest.objective || currentQuest.description}\n`;
            info += `Reward: ${currentQuest.reward} points\n\n`;
            
            info += `NEXT QUESTS:\n`;
            allQuests.forEach((quest, index) => {
                if (index > gameState.currentQuest && index < gameState.currentQuest + 3) {
                    const status = quest.completed ? '‚úì' : index === gameState.currentQuest ? '‚Üí' : '‚óã';
                    info += `${status} ${quest.name} ${quest.adult ? '(18+)' : ''}\n`;
                }
            });
            
            alert(info);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Action buttons
            document.getElementById('look-btn').addEventListener('click', () => {
                addMessage('Larry: *Looks around the room*', 'player');
                addComment('Eve', 'He\'s looking around like a lost puppy.');
                updateQuestProgress(1, 5); // Small progress for looking around
            });
            
            document.getElementById('talk-btn').addEventListener('click', () => {
                updateDialogOptions();
                showNotification('Dialog options updated!');
            });
            
            document.getElementById('use-btn').addEventListener('click', () => {
                if (gameState.selectedItem) {
                    const item = gameState.items[gameState.selectedItem];
                    addMessage(`Larry: *Uses ${item.name}*`, 'player', item.adult);
                    
                    // Different effects based on item
                    let moodChange = 0;
                    let relationshipChange = 0;
                    let questProgress = 0;
                    
                    switch(gameState.selectedItem) {
                        case 'flowers':
                            moodChange = 20;
                            relationshipChange = 10;
                            questProgress = 50;
                            updateQuestProgress(3, questProgress);
                            break;
                        case 'drink':
                            moodChange = 15;
                            relationshipChange = 5;
                            questProgress = 50;
                            updateQuestProgress(2, questProgress);
                            break;
                        case 'wine':
                            moodChange = 25;
                            relationshipChange = 15;
                            questProgress = 25;
                            updateQuestProgress(6, questProgress);
                            break;
                        case 'champagne':
                            moodChange = 30;
                            relationshipChange = 20;
                            questProgress = 30;
                            updateQuestProgress(6, questProgress);
                            break;
                        case 'condom':
                            if (gameState.adultMode && gameState.relationship > 60) {
                                moodChange = 40;
                                relationshipChange = 30;
                                questProgress = 50;
                                updateQuestProgress(6, questProgress);
                                addComment('Eve', 'He\'s confident, I\'ll give him that...', true);
                            } else {
                                moodChange = -20;
                                relationshipChange = -10;
                                showNotification('Too soon for that! Build relationship first.');
                            }
                            break;
                        case 'perfume':
                            moodChange = 25;
                            relationshipChange = 15;
                            questProgress = 50;
                            updateQuestProgress(4, questProgress);
                            break;
                        case 'roomKey':
                            moodChange = 35;
                            relationshipChange = 25;
                            questProgress = 50;
                            updateQuestProgress(5, questProgress);
                            break;
                        default:
                            moodChange = 5;
                            relationshipChange = 3;
                            break;
                    }
                    
                    setTimeout(() => {
                        const responses = [
                            'Nice try, but not quite.',
                            'Interesting choice...',
                            'That was... unexpected.',
                            'You\'re full of surprises.'
                        ];
                        
                        if (moodChange > 20) {
                            addMessage('Eve: Oh my! You really know how to impress a girl!', 'npc', item.adult);
                        } else if (moodChange > 0) {
                            addMessage(`Eve: ${responses[Math.floor(Math.random() * responses.length)]}`, 'npc', item.adult);
                        } else {
                            addMessage('Eve: That was... inappropriate.', 'npc');
                        }
                        
                        gameState.mood = Math.max(0, Math.min(100, gameState.mood + moodChange));
                        gameState.relationship += relationshipChange;
                        gameState.score += 50;
                        
                        // Remove consumable items after use
                        const consumables = ['drink', 'wine', 'champagne', 'flowers', 'perfume'];
                        if (consumables.includes(gameState.selectedItem)) {
                            const index = gameState.inventory.indexOf(gameState.selectedItem);
                            if (index > -1) {
                                gameState.inventory.splice(index, 1);
                                renderInventory();
                            }
                        }
                        
                        gameState.selectedItem = null;
                        updateStats();
                        renderInventory();
                    }, 500);
                } else {
                    showNotification('Select an item from inventory first!');
                }
            });
            
            document.getElementById('move-btn').addEventListener('click', () => {
                const locations = ['bar', 'hotel', 'beach', 'casino', 'hotelRoom'];
                const currentIndex = locations.indexOf(gameState.currentLocation);
                let nextIndex = (currentIndex + 1) % locations.length;
                
                // Skip locked locations
                while (gameState.locations.find(loc => loc.id === locations[nextIndex])?.locked) {
                    nextIndex = (nextIndex + 1) % locations.length;
                    if (nextIndex === currentIndex) break; // Prevent infinite loop
                }
                
                gameState.currentLocation = locations[nextIndex];
                const location = gameState.locations.find(loc => loc.id === gameState.currentLocation);
                
                showNotification(`Moved to: ${location.name}`);
                renderScene();
                renderMiniMap();
                addComment('Eve', 'He moved to a different location. Persistent, I\'ll give him that.');
                
                // Reset dialog options for new location
                updateDialogOptions();
            });
            
            document.getElementById('examine-btn').addEventListener('click', () => {
                const location = gameState.locations.find(loc => loc.id === gameState.currentLocation);
                const examineTexts = {
                    bar: "The bar is dimly lit with a sophisticated atmosphere. There's a jukebox in the corner playing soft jazz. Several interesting items are scattered around.",
                    hotel: "The hotel lobby is luxurious with marble floors. The reception desk looks expensive. You notice some items on the tables.",
                    beach: "The beach is beautiful with golden sand. The sunset creates a romantic atmosphere. Various beach items are visible.",
                    casino: "The casino is bustling with activity. Slot machines ring and cards shuffle. There might be useful items around.",
                    hotelRoom: "The suite is spacious with a king-size bed and a balcony overlooking the city. Romantic items are placed around the room."
                };
                
                addMessage(`Larry: ${examineTexts[gameState.currentLocation] || "It's an interesting place."}`, 'player');
                addComment('Eve', 'He\'s examining the surroundings. At least he\'s observant.');
                updateQuestProgress(1, 5); // Small progress for examining
            });
            
            document.getElementById('flirt-btn').addEventListener('click', () => {
                if (gameState.adultMode) {
                    const flirtLines = [
                        "Your eyes are like deep pools I could swim in... all night.",
                        "Is it hot in here, or is it just you?",
                        "I'm not a photographer, but I can picture us together.",
                        "Do you believe in love at first sight, or should I walk by again?",
                        "If you were a fruit, you'd be a fine-apple."
                    ];
                    
                    const flirtLine = flirtLines[Math.floor(Math.random() * flirtLines.length)];
                    addMessage(`Larry: ${flirtLine}`, 'player', true);
                    
                    setTimeout(() => {
                        if (gameState.relationship > 40) {
                            const responses = [
                                "*giggles* Smooth, very smooth.",
                                "Okay, that was actually good.",
                                "You're charming, I'll give you that.",
                                "Keep talking like that and you might just get somewhere."
                            ];
                            addMessage(`Eve: ${responses[Math.floor(Math.random() * responses.length)]}`, 'npc', true);
                            gameState.mood += 15;
                            gameState.relationship += 10;
                            updateQuestProgress(6, 10); // Small progress for romantic evening
                        } else {
                            addMessage('Eve: Seriously? Try harder.', 'npc');
                            gameState.mood -= 10;
                        }
                        updateStats();
                    }, 500);
                } else {
                    showNotification('Flirt mode requires Adult Mode to be enabled!');
                }
            });
            
            // Quest info button
            document.getElementById('quest-info-btn').addEventListener('click', showQuestInfo);
            
            document.getElementById('save-btn').addEventListener('click', () => {
                localStorage.setItem('larryGameSave', JSON.stringify(gameState));
                showNotification('Game saved successfully!');
                addComment('Eve', 'He saved the game. Not confident about his chances?');
            });
            
            document.getElementById('load-btn').addEventListener('click', () => {
                const savedGame = localStorage.getItem('larryGameSave');
                if (savedGame) {
                    Object.assign(gameState, JSON.parse(savedGame));
                    updateStats();
                    renderScene();
                    renderInventory();
                    renderMiniMap();
                    showNotification('Game loaded successfully!');
                    addComment('Eve', 'He loaded a previous save. Trying to undo mistakes?');
                } else {
                    showNotification('No saved game found!');
                }
            });
            
            document.getElementById('reset-btn').addEventListener('click', () => {
                if (confirm('Are you sure you want to reset the game? All progress will be lost!')) {
                    localStorage.removeItem('larryGameSave');
                    location.reload();
                }
            });
            
            // AI toggle
            aiToggle.addEventListener('click', () => {
                gameState.aiMode = !gameState.aiMode;
                aiToggle.innerHTML = `<span>ü§ñ AI: ${gameState.aiMode ? 'ON' : 'OFF'}</span>`;
                showNotification(`AI Mode ${gameState.aiMode ? 'Enabled' : 'Disabled'}`);
            });
            
            // Character interactions
            playerCharacter.addEventListener('click', () => {
                addMessage('Larry: *Adjusts his tie* Looking good!', 'player');
                addComment('Eve', 'He\'s checking himself out. How vain.');
            });
            
            eveCharacter.addEventListener('click', () => {
                if (gameState.relationship > 50) {
                    addMessage('Eve: *smiles* Enjoying the view?', 'npc', true);
                    gameState.mood += 5;
                    updateStats();
                } else {
                    addMessage('Eve: Can I help you?', 'npc');
                }
            });
            
            // Add CSS for pulse animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { transform: scale(1); }
                    50% { transform: scale(1.05); }
                    100% { transform: scale(1); }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>
